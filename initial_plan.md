
## NEURAL INBOX โ ะะะะ ะะะะะะขะ v1

### ๐ฏ VISION

**ะะดะฝะฐ ัััะพะบะฐ:** "ะัะพัะพะน ะผะพะทะณ ะฒ Telegram โ ะบะธะดะฐะตัั ะฒัั, ะฝะฐัะพะดะธัั ััะพ ัะณะพะดะฝะพ"

**ะะปั ะบะพะณะพ:** ะกััะดะตะฝัั ะธ ััะธะปะฐะฝัะตัั, ั ะบะพัะพััั ะธะฝัะพัะผะฐัะธั ัะฐะทะฑัะพัะฐะฝะฐ ะฟะพ 10 ะผะตััะฐะผ

**ะะปะฐะฒะฝะฐั ะฑะพะปั:** "ะกะพััะฐะฝะธะป ะธ ะทะฐะฑัะป" โ Saved Messages ะฑะตะท ััััะบัััั, ะฟะพะธัะบะฐ ะธ ะฝะฐะฟะพะผะธะฝะฐะฝะธะน

---

## CORE ะะะะฆะะะฆะะฏ

```
ะะฅะะ (ะปัะฑะพะน)          AI ROUTER           ะะะะกะขะะะ
     โ                    โ                   โ
ะขะตะบัั โโโโ                โ              โโโโ SAVE โ ะบะปะฐััะธัะธะบะฐัะธั โ ัะพััะฐะฝะตะฝะธะต
ะะพะปะพั โโโโผโโโบ Neural โโโโโโผโโโบ Intent? โโโผโโโ QUERY โ ะฟะพะธัะบ โ ะพัะฒะตั  
ะคะพัะพ โโโโโค    Inbox       โ              โโโโ ACTION โ ะฒัะฟะพะปะฝะตะฝะธะต
PDF โโโโโโค                โ              โโโโ CHAT โ ะพัะฒะตั
ะกััะปะบะธ โโโค                โ
ะคะพัะฒะฐัะดัโโ                โ
```

---

## 1. AI ROUTER โ ะฏะะะ ะกะะกะขะะะซ

### ะะธะบะฐะบะธั ะบะพะผะฐะฝะด. ะขะพะปัะบะพ ะตััะตััะฒะตะฝะฝัะน ัะทัะบ.


```
"ะดะพะณะพะฒะพั ั ะะตััะพะฒัะผ"           โ AI ะฟะพะฝะธะผะฐะตั: QUERY
"ะบัะฟะธัั ะผะพะปะพะบะพ ะทะฐะฒััะฐ"         โ AI ะฟะพะฝะธะผะฐะตั: SAVE (task)
"ััะพ ั ะผะตะฝั ะฝะฐ ัะตะณะพะดะฝั"        โ AI ะฟะพะฝะธะผะฐะตั: QUERY
"ัะดะฐะปะธ ะทะฐะดะฐัั ะฟัะพ ะผะพะปะพะบะพ"      โ AI ะฟะพะฝะธะผะฐะตั: ACTION
"ัะฟะฐัะธะฑะพ!"                     โ AI ะฟะพะฝะธะผะฐะตั: CHAT
```

### Intention Classifier

```python
class Intent(Enum):
    SAVE = "save"       # ะัะพะดััะฐั ะธะฝัะพัะผะฐัะธั (ะผััะปั, ะทะฐะดะฐัะฐ, ัะฐะนะป)
    QUERY = "query"     # ะะพะฟัะพั ะบ ะฑะฐะทะต ะทะฝะฐะฝะธะน
    ACTION = "action"   # ะะพะผะฐะฝะดะฐ ะฝะฐ ะธะทะผะตะฝะตะฝะธะต
    CHAT = "chat"       # ะะพะปัะพะฒะฝั, ะฑะปะฐะณะพะดะฐัะฝะพััั
    UNCLEAR = "unclear" # ะะตะพะดะฝะพะทะฝะฐัะฝะพ โ ะฝัะถะฝะพ ััะพัะฝะธัั
```

### ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผั ะดะฒััะผััะปะตะฝะฝะพััะธ

**ะัะพะฑะปะตะผะฐ:** "ะะพะธัะบ ัะพัััะดะฝะธะบะพะฒ" โ ััะพ ะทะฐะดะฐัะฐ ะธะปะธ ะทะฐะฟัะพั?

**ะะตัะตะฝะธะต: ะะพะฝัะตะบััะฝัะต ัะธะณะฝะฐะปั + ะฃัะพัะฝะตะฝะธะต**

|ะกะธะณะฝะฐะป|ะกะบะพัะตะต SAVE|ะกะบะพัะตะต QUERY|
|---|---|---|
|ะะผะฟะตัะฐัะธะฒ|"ะะฐะนัะธ ัะพัััะดะฝะธะบะฐ"|โ|
|ะะพะฟัะพั|โ|"ะะดะต ะทะฐะผะตัะบะฐ ะฟัะพ ะฝะฐะนะผ?"|
|ะัะตะผั|"ะทะฐะฒััะฐ", "ะดะพ ะฟััะฝะธัั"|โ|
|"ะงัะพ/ะณะดะต/ะบะพะณะดะฐ"|โ|"ะงัะพ ัะฐะผ ะฑัะปะพ ะฟัะพ..."|
|ะะพะฝัะตะบัั ะดะธะฐะปะพะณะฐ|ะะพัะปะต "ะทะฐะฟะพะผะฝะธ"|ะะพัะปะต "ะฟะพะบะฐะถะธ"|
|ะะปะธะฝะฐ|ะะพัะพัะบะธะต ััะฐะทั ัะฐัะต SAVE|ะะฐะทะฒััะฝัััะต ะฒะพะฟัะพัั = QUERY|

**ะัะปะธ ะฝะตััะฝะพ โ ัะฟัะฐัะธะฒะฐะตะผ:**

```
User: "ะะพะธัะบ ัะพัััะดะฝะธะบะพะฒ"

Bot: "ะกะพััะฐะฝะธัั ะบะฐะบ ะทะฐะดะฐัั 'ะะพะธัะบ ัะพัััะดะฝะธะบะพะฒ' 
      ะธะปะธ ะฝะฐะนัะธ ัะฒะพะธ ะทะฐะผะตัะบะธ ะฝะฐ ััั ัะตะผั?"
      
      [๐พ ะกะพััะฐะฝะธัั]  [๐ ะะฐะนัะธ]
```

### System Prompt ะดะปั Router

```python
ROUTER_PROMPT = """
ะะฟัะตะดะตะปะธ ะฝะฐะผะตัะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั. ะัะฒะตัั ะขะะะฌะะ JSON:

{
  "intent": "save|query|action|chat|unclear",
  "confidence": 0.0-1.0,
  "reasoning": "ะฟะพัะตะผั ัะฐะบ ัะตัะธะป"
}

ะะะะะะะ:
- SAVE: ะฝะพะฒะฐั ะธะฝัะพัะผะฐัะธั, ะทะฐะดะฐัะฐ, ะธะดะตั, ัะฐะนะป, ัััะปะบะฐ
- QUERY: ะฒะพะฟัะพั, ะฟะพะธัะบ, "ััะพ ัะฐะผ ะฑัะปะพ", "ะฟะพะบะฐะถะธ", "ะฝะฐะนะดะธ"
- ACTION: ะธะทะผะตะฝะธัั, ัะดะฐะปะธัั, ะพัะผะตัะธัั, ะฟะตัะตะฝะตััะธ ัััะตััะฒัััะตะต
- CHAT: ะฟัะธะฒะตัััะฒะธะต, ะฑะปะฐะณะพะดะฐัะฝะพััั, small talk
- UNCLEAR: ะตัะปะธ confidence < 0.7, ะฒะตัะฝะธ unclear

ะะะะะะะซ:
"ะบัะฟะธัั ะผะพะปะพะบะพ" โ save (ะธะผะฟะตัะฐัะธะฒ, ะบะพัะพัะบะฐั ััะฐะทะฐ)
"ััะพ ะบัะฟะธัั" โ query (ะฒะพะฟัะพั)
"ัะดะฐะปะธ ะทะฐะดะฐัั ะฟัะพ ะผะพะปะพะบะพ" โ action (ัะฒะฝะพะต ะดะตะนััะฒะธะต ะฝะฐะด ัััะตััะฒัััะธะผ)
"ัะฟะฐัะธะฑะพ" โ chat
"ะฟะพะธัะบ ัะพัััะดะฝะธะบะพะฒ" โ unclear (ะผะพะถะตั ะฑััั ะธ ะทะฐะดะฐัะฐ, ะธ ะทะฐะฟัะพั)
"""
```

---

## 2. ะะฅะะะซ โ ััะพ ะฟัะธะฝะธะผะฐะตั ะฑะพั

|ะขะธะฟ|ะะฑัะฐะฑะพัะบะฐ|ะัะธะผะตั|
|---|---|---|
|**ะขะตะบัั**|Router โ NLP|"ะัััะตัะฐ ั ะะธัะตะน ะทะฐะฒััะฐ ะฒ 15:00"|
|**ะะพะปะพัะพะฒะพะต**|Whisper โ Router โ NLP|ะะฐะดะธะบัะพะฒะฐะป ะผััะปั ะฒ ะผะตััะพ|
|**ะคะพัะพ/ัะบัะธะฝัะพั**|GPT-4o Vision โ Router|ะกะบัะธะฝ ะฟะตัะตะฟะธัะบะธ, ัะฐัะฟะธัะฐะฝะธะต|
|**PDF/ะดะพะบัะผะตะฝั**|Extract โ Router|ะขะ, ะดะพะณะพะฒะพั, ะฑะธะปะตั|
|**ะกััะปะบะฐ**|Parse โ Router|ะกัะฐััั, ะฒะธะดะตะพ|
|**ะคะพัะฒะฐัะด**|+ ะบะพะฝัะตะบัั ะพัะฟัะฐะฒะธัะตะปั|ะะตัะตัะปะฐะป ะธะท ัะฐะฑะพัะตะณะพ ัะฐัะฐ|

---

## 3. ะขะะะซ ะะะะขะะะขะ (Items)

|ะขะธะฟ|ะะฟะธัะฐะฝะธะต|ะขัะธะณะณะตัั ะฐะฒัะพะพะฟัะตะดะตะปะตะฝะธั|
|---|---|---|
|**task**|ะขัะตะฑัะตั ะดะตะนััะฒะธั|ะะผะฟะตัะฐัะธะฒั, ะดะฐัั, "ะฝะฐะดะพ", "ะฝัะถะฝะพ"|
|**idea**|ะััะปั ะฝะฐ ะฑัะดััะตะต|"ะะดะตั:", "ะ ััะพ ะตัะปะธ", "ะะพะถะฝะพ ะฑั"|
|**note**|ะกะฟัะฐะฒะพัะฝะฐั ะธะฝัะพัะผะฐัะธั|ะคะฐะบัั, ะพะฟัะตะดะตะปะตะฝะธั, ะฑะตะท ะดะตะนััะฒะธั|
|**resource**|ะกััะปะบะฐ/ัะฐะนะป|URL, PDF, "ะฟะพัะธัะฐัั", "ะฟะพัะผะพััะตัั"|
|**contact**|ะงะตะปะพะฒะตะบ/ะบะพะผะฟะฐะฝะธั|ะะผั + ัะตะปะตัะพะฝ/email/@username|
|**event**|ะกะพะฑััะธะต ั ะดะฐัะพะน|"ะัััะตัะฐ", "ัะพะทะฒะพะฝ", ะบะพะฝะบัะตัะฝะพะต ะฒัะตะผั|

---

## 4. ะะะะะะงะะะะ ะะะะะซะฅ

### Entities

|ะะพะปะต|ะะฟะธัะฐะฝะธะต|ะัะธะผะตั|
|---|---|---|
|`people[]`|ะฃะฟะพะผัะฝัััะต ะปัะดะธ|["ะะธัะฐ", "@designer"]|
|`dates[]`|ะะฐัั (raw + normalized)|[{"raw": "ะทะฐะฒััะฐ", "iso": "2025-01-14"}]|
|`places[]`|ะะตััะฐ|["ะพัะธั", "zoom"]|
|`urls[]`|ะกััะปะบะธ|["https://meet.google..."]|
|`phones[]`|ะขะตะปะตัะพะฝั|["+7700..."]|
|`tags[]`|ะะฒัะพ-ัะตะณะธ|["#ัะฐะฑะพัะฐ", "#ััะพัะฝะพ"]|

### ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผั ะณะฐะปะปััะธะฝะฐัะธะน ะฒ ะดะฐัะฐั

**ะัะตะณะดะฐ ัะพััะฐะฝัะตะผ ะะะ ะฒะฐัะธะฐะฝัะฐ:**

```python
{
  "due_at": "2025-01-14T15:00:00Z",      # ISO ะดะปั ะปะพะณะธะบะธ
  "due_at_raw": "ะทะฐะฒััะฐ ะฒ 15:00",         # ะัะธะณะธะฝะฐะป ะดะปั ะพัะพะฑัะฐะถะตะฝะธั
  "due_at_display": "ะะฐะฒััะฐ (14 ัะฝะฒ) 15:00"  # ะะปั UI
}
```

**ะ UI ะฟะพะบะฐะทัะฒะฐะตะผ:**

```
โ ะัััะตัะฐ ั ะะธัะตะน
  โฐ ะะฐะฒััะฐ (14 ัะฝะฒ) 15:00    โ ัะทะตั ะฒะธะดะธั, ะบะฐะบ ะฑะพั ะฟะพะฝัะป
```

**ะัะปะธ ะฑะพั ะพัะธะฑัั** โ ัะทะตั ััะฐะทั ััะพ ะฒะธะดะธั ะธ ะผะพะถะตั ะฟะพะฟัะฐะฒะธัั.

---

## 5. ะฅะะะะะะะ โ ััััะบัััะฐ ะดะฐะฝะฝัั

### ะขะฐะฑะปะธัะฐ `items`

```sql
CREATE TABLE items (
    id SERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    
    -- ะขะธะฟ ะธ ััะฐััั
    type VARCHAR(20) NOT NULL,           -- task/idea/note/resource/contact/event
    status VARCHAR(20) DEFAULT 'inbox',  -- inbox/active/done/archived
    
    -- ะะพะฝัะตะฝั
    title VARCHAR(500),                   -- ะัะฐัะบะพะต ะฝะฐะทะฒะฐะฝะธะต
    content TEXT,                         -- ะะพะปะฝัะน ัะตะบัั/summary
    original_input TEXT,                  -- ะกััะพะน ะฒะฒะพะด (ะดะปั ะพัะปะฐะดะบะธ)
    source VARCHAR(20),                   -- text/voice/photo/pdf/forward/link
    
    -- ะะฐัั (ั ะทะฐัะธัะพะน ะพั ะณะฐะปะปััะธะฝะฐัะธะน)
    due_at TIMESTAMPTZ,                   -- ะะพัะผะฐะปะธะทะพะฒะฐะฝะฝัะน ะดะตะดะปะฐะนะฝ
    due_at_raw VARCHAR(100),              -- ะัะธะณะธะฝะฐะปัะฝัะน ัะตะบัั ("ะทะฐะฒััะฐ ะฒ 15:00")
    remind_at TIMESTAMPTZ,
    
    -- ะัะณะฐะฝะธะทะฐัะธั
    priority VARCHAR(10),                 -- high/medium/low
    project_id INTEGER REFERENCES projects(id),
    tags JSONB DEFAULT '[]',
    entities JSONB DEFAULT '{}',          -- people, urls, phones, places
    
    -- ะะพะธัะบ
    content_tsv TSVECTOR,                 -- ะะพะปะฝะพัะตะบััะพะฒัะน ะฟะพะธัะบ
    embedding VECTOR(1536),               -- ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ
    
    -- ะะตัะฐะดะฐะฝะฝัะต
    origin_user_name VARCHAR(255),        -- ะะปั ัะพัะฒะฐัะดะพะฒ
    attachment_file_id VARCHAR(255),
    attachment_type VARCHAR(20),
    
    -- Timestamps
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),
    completed_at TIMESTAMPTZ,
    
    -- ะะฝะดะตะบัั ัะพะทะดะฐัะผ ะพัะดะตะปัะฝะพ
    CONSTRAINT valid_type CHECK (type IN ('task','idea','note','resource','contact','event')),
    CONSTRAINT valid_status CHECK (status IN ('inbox','active','done','archived'))
);

-- ะะฝะดะตะบัั
CREATE INDEX idx_items_user_status ON items(user_id, status);
CREATE INDEX idx_items_user_type ON items(user_id, type);
CREATE INDEX idx_items_due_at ON items(due_at) WHERE due_at IS NOT NULL;
CREATE INDEX idx_items_content_tsv ON items USING GIN(content_tsv);
CREATE INDEX idx_items_embedding ON items USING ivfflat(embedding vector_cosine_ops);
CREATE INDEX idx_items_tags ON items USING GIN(tags);
```

### ะขะฐะฑะปะธัะฐ `projects` (ะฟะปะพัะบะฐั, ะฑะตะท ะธะตัะฐััะธะธ)

```sql
CREATE TABLE projects (
    id SERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    name VARCHAR(100) NOT NULL,
    color VARCHAR(7),                     -- #HEX
    emoji VARCHAR(10),
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### ะขะฐะฑะปะธัะฐ `item_links` (ะดะปั ะฐะฒัะพะปะธะฝะบะธะฝะณะฐ)

```sql
CREATE TABLE item_links (
    id SERIAL PRIMARY KEY,
    item_id INTEGER REFERENCES items(id) ON DELETE CASCADE,
    related_item_id INTEGER REFERENCES items(id) ON DELETE CASCADE,
    link_type VARCHAR(20),                -- related/suggested/duplicate
    confidence FLOAT,                     -- ะะปั ะฐะฒัะพะฟัะตะดะปะพะถะตะฝะธะน
    confirmed BOOLEAN DEFAULT FALSE,      -- ะฎะทะตั ะฟะพะดัะฒะตัะดะธะป?
    created_at TIMESTAMPTZ DEFAULT NOW(),
    
    UNIQUE(item_id, related_item_id)
);
```

### ะขะฐะฑะปะธัะฐ `users`

```sql
CREATE TABLE users (
    user_id BIGINT PRIMARY KEY,
    timezone VARCHAR(50) DEFAULT 'Asia/Almaty',
    language VARCHAR(5) DEFAULT 'ru',
    settings JSONB DEFAULT '{}',
    onboarding_done BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 6. HYBRID SEARCH โ ะฟะพะปะฝะพัะตะบััะพะฒัะน + ะฒะตะบัะพัะฝัะน

### ะะพัะตะผั ะพะฑะฐ?

|ะขะธะฟ ะฟะพะธัะบะฐ|ะฅะพัะพั ะดะปั|ะะปะพั ะดะปั|
|---|---|---|
|**tsvector**|"ะดะพะณะพะฒะพั โ45-ะคะ", ัะพัะฝัะต ัะปะพะฒะฐ|"ะดะพะบัะผะตะฝั ะฟัะพ ะดะตะฝัะณะธ"|
|**pgvector**|"ะดะพะบัะผะตะฝั ะฟัะพ ะดะตะฝัะณะธ", ัะผััะปั|"โ45-ะคะ"|

### ะะตะฐะปะธะทะฐัะธั Hybrid Search

```python
async def hybrid_search(user_id: int, query: str, limit: int = 10) -> list[Item]:
    """
    ะะพะผะฑะธะฝะธััะตั ะฟะพะปะฝะพัะตะบััะพะฒัะน ะธ ะฒะตะบัะพัะฝัะน ะฟะพะธัะบ.
    ะัะฟะพะปัะทัะตั Reciprocal Rank Fusion ะดะปั ะพะฑัะตะดะธะฝะตะฝะธั ัะตะทัะปััะฐัะพะฒ.
    """
    
    # 1. ะะพะปะฝะพัะตะบััะพะฒัะน ะฟะพะธัะบ (ัะพัะฝัะต ัะพะฒะฟะฐะดะตะฝะธั)
    fts_results = await db.execute("""
        SELECT id, ts_rank(content_tsv, plainto_tsquery('russian', $1)) as rank
        FROM items
        WHERE user_id = $2 
          AND content_tsv @@ plainto_tsquery('russian', $1)
        ORDER BY rank DESC
        LIMIT $3
    """, query, user_id, limit * 2)
    
    # 2. ะะตะบัะพัะฝัะน ะฟะพะธัะบ (ัะตะผะฐะฝัะธะบะฐ)
    query_embedding = await get_embedding(query)
    vector_results = await db.execute("""
        SELECT id, 1 - (embedding <=> $1) as similarity
        FROM items
        WHERE user_id = $2
          AND embedding IS NOT NULL
        ORDER BY embedding <=> $1
        LIMIT $3
    """, query_embedding, user_id, limit * 2)
    
    # 3. Reciprocal Rank Fusion
    k = 60  # RRF constant
    scores = {}
    
    for rank, (id, _) in enumerate(fts_results):
        scores[id] = scores.get(id, 0) + 1 / (k + rank + 1)
    
    for rank, (id, _) in enumerate(vector_results):
        scores[id] = scores.get(id, 0) + 1 / (k + rank + 1)
    
    # 4. ะกะพััะธััะตะผ ะฟะพ combined score
    sorted_ids = sorted(scores.keys(), key=lambda x: scores[x], reverse=True)[:limit]
    
    return await get_items_by_ids(sorted_ids)
```

### ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต tsvector

```sql
-- ะขัะธะณะณะตั ะดะปั ะฐะฒัะพะพะฑะฝะพะฒะปะตะฝะธั tsvector
CREATE OR REPLACE FUNCTION update_content_tsv() RETURNS TRIGGER AS $$
BEGIN
    NEW.content_tsv := 
        setweight(to_tsvector('russian', COALESCE(NEW.title, '')), 'A') ||
        setweight(to_tsvector('russian', COALESCE(NEW.content, '')), 'B');
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER items_tsv_trigger 
    BEFORE INSERT OR UPDATE ON items
    FOR EACH ROW EXECUTE FUNCTION update_content_tsv();
```

---

## 7. AI AGENT โ ะธะฝััััะผะตะฝัั (ะฑะตะท ะบะพะผะฐะฝะด)

```python
AGENT_TOOLS = [
    # === ะกะะฅะะะะะะะ ===
    {
        "name": "save_item",
        "description": "ะกะพััะฐะฝะธัั ะฝะพะฒัะน ัะปะตะผะตะฝั. AI ัะฐะผ ะพะฟัะตะดะตะปัะตั ัะธะฟ.",
        "parameters": {
            "title": "ะัะฐัะบะพะต ะฝะฐะทะฒะฐะฝะธะต",
            "content": "ะะพะปะฝะพะต ัะพะดะตัะถะฐะฝะธะต (ะพะฟัะธะพะฝะฐะปัะฝะพ)",
            "type": "task|idea|note|resource|contact|event (ะฐะฒัะพ ะตัะปะธ ะฝะต ัะบะฐะทะฐะฝ)",
            "due_at": "ISO ะดะฐัะฐ ะดะตะดะปะฐะนะฝะฐ (ะพะฟัะธะพะฝะฐะปัะฝะพ)",
            "due_at_raw": "ะัะธะณะธะฝะฐะปัะฝัะน ัะตะบัั ะดะฐัั ('ะทะฐะฒััะฐ ะฒ 15:00')",
            "tags": "ะกะฟะธัะพะบ ัะตะณะพะฒ",
            "project": "ะะฐะทะฒะฐะฝะธะต ะฟัะพะตะบัะฐ (ะพะฟัะธะพะฝะฐะปัะฝะพ)",
            "priority": "high|medium|low"
        }
    },
    
    # === ะะะะกะ ===
    {
        "name": "search",
        "description": "ะะฐะนัะธ ัะปะตะผะตะฝัั ะฟะพ ัะผััะปั ะธะปะธ ัะพัะฝะพะผั ัะพะฒะฟะฐะดะตะฝะธั",
        "parameters": {
            "query": "ะะพะธัะบะพะฒัะน ะทะฐะฟัะพั",
            "type_filter": "ะคะธะปััั ะฟะพ ัะธะฟั (ะพะฟัะธะพะฝะฐะปัะฝะพ)",
            "project_filter": "ะคะธะปััั ะฟะพ ะฟัะพะตะบัั (ะพะฟัะธะพะฝะฐะปัะฝะพ)",
            "date_from": "ะะฐัะฐ ะพั",
            "date_to": "ะะฐัะฐ ะดะพ"
        }
    },
    
    {
        "name": "get_items",
        "description": "ะะพะปััะธัั ัะปะตะผะตะฝัั ะฟะพ ัะธะปัััะฐะผ",
        "parameters": {
            "filter": "inbox|today|tomorrow|week|overdue|all",
            "type": "task|idea|note|resource|contact|event (ะพะฟัะธะพะฝะฐะปัะฝะพ)",
            "project": "ะะฐะทะฒะฐะฝะธะต ะฟัะพะตะบัะฐ (ะพะฟัะธะพะฝะฐะปัะฝะพ)"
        }
    },
    
    # === ะะะะกะขะะะฏ ===
    {
        "name": "complete_item",
        "description": "ะัะผะตัะธัั ัะปะตะผะตะฝั ะฒัะฟะพะปะฝะตะฝะฝัะผ",
        "parameters": {"item_id": "ID ะธะปะธ ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั ะดะปั ะธะดะตะฝัะธัะธะบะฐัะธะธ"}
    },
    
    {
        "name": "update_item",
        "description": "ะะฑะฝะพะฒะธัั ัะปะตะผะตะฝั",
        "parameters": {
            "item_id": "ID ะธะปะธ ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั",
            "updates": {
                "title": "ะะพะฒะพะต ะฝะฐะทะฒะฐะฝะธะต",
                "due_at": "ะะพะฒัะน ะดะตะดะปะฐะนะฝ",
                "type": "ะะพะฒัะน ัะธะฟ",
                "tags": "ะะพะฒัะต ัะตะณะธ",
                "project": "ะะพะฒัะน ะฟัะพะตะบั",
                "priority": "ะะพะฒัะน ะฟัะธะพัะธัะตั"
            }
        }
    },
    
    {
        "name": "delete_item",
        "description": "ะฃะดะฐะปะธัั ัะปะตะผะตะฝั",
        "parameters": {"item_id": "ID ะธะปะธ ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั"}
    },
    
    {
        "name": "snooze_item",
        "description": "ะัะปะพะถะธัั ะฝะฐะฟะพะผะธะฝะฐะฝะธะต",
        "parameters": {
            "item_id": "ID ะธะปะธ ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั",
            "until": "ะะพะณะดะฐ ะฝะฐะฟะพะผะฝะธัั (ISO ะธะปะธ 'tomorrow', '+1h', '+30m')"
        }
    },
    
    # === ะะะขะะะะะะะะ ===
    {
        "name": "suggest_links",
        "description": "ะะฐะนัะธ ัะฒัะทะฐะฝะฝัะต ัะปะตะผะตะฝัั ะดะปั ะฐะฒัะพะปะธะฝะบะธะฝะณะฐ",
        "parameters": {"item_id": "ID ัะปะตะผะตะฝัะฐ"}
    },
    
    {
        "name": "link_items",
        "description": "ะกะฒัะทะฐัั ะดะฒะฐ ัะปะตะผะตะฝัะฐ",
        "parameters": {
            "item_id": "ID ะฟะตัะฒะพะณะพ ัะปะตะผะตะฝัะฐ",
            "related_id": "ID ัะฒัะทะฐะฝะฝะพะณะพ ัะปะตะผะตะฝัะฐ"
        }
    },
    
    # === ะะะะะะขะซ ===
    {
        "name": "manage_project",
        "description": "ะกะพะทะดะฐัั ะธะปะธ ะฟะพะปััะธัั ะฟัะพะตะบัั",
        "parameters": {
            "action": "create|list|get",
            "name": "ะะฐะทะฒะฐะฝะธะต (ะดะปั create)",
            "project_id": "ID (ะดะปั get)"
        }
    }
]
```

---

## 8. ะะะขะะะะะะะะ โ "ะะฐั-ัััะตะบั"

### ะะฐะบ ัะฐะฑะพัะฐะตั

```
User ัะพััะฐะฝัะตั: "ะะฒะฐะฝ ะะธะทะฐะนะฝะตั +7707123456"

Bot (ะฒ ัะพะฝะต):
1. ะะฟัะตะดะตะปัะตั: type=contact, entities.people=["ะะฒะฐะฝ"], tags=[#ะดะธะทะฐะนะฝ]
2. ะัะตั ะฟะพัะพะถะธะต items:
   - ะะฐะดะฐัะฐ "ะะตะฑัะตะฝะดะธะฝะณ ัะฐะนัะฐ" (ัะตะณ #ะดะธะทะฐะนะฝ)
   - ะะฐะผะตัะบะฐ "ะะตัะตัะตะฝัั ะดะปั ัะตะดะธะทะฐะนะฝะฐ"
3. ะัะปะธ confidence > 0.7 โ ะฟัะตะดะปะฐะณะฐะตั:

Bot: "ะกะพััะฐะฝะธะป ะบะพะฝัะฐะบั: ะะฒะฐะฝ ะะธะทะฐะนะฝะตั ๐
      
      ะะฐะถะตััั, ะพะฝ ัะฒัะทะฐะฝ ั ะฟัะพะตะบัะพะผ 'ะะตะฑัะตะฝะดะธะฝะณ'. 
      ะกะฒัะทะฐัั?
      
      [โ ะะฐ, ัะฒัะทะฐัั]  [โ ะะตั]"
```

### ะะตะฐะปะธะทะฐัะธั

```python
async def auto_suggest_links(item_id: int, user_id: int) -> list[SuggestedLink]:
    """
    ะะฐัะพะดะธั ะฟะพัะตะฝัะธะฐะปัะฝะพ ัะฒัะทะฐะฝะฝัะต ัะปะตะผะตะฝัั.
    ะะฐะฟััะบะฐะตััั ะฒ ัะพะฝะต ะฟะพัะปะต ัะพััะฐะฝะตะฝะธั.
    """
    item = await get_item(item_id)
    
    # 1. ะะพะธัะบ ะฟะพ entities (ะปัะดะธ, ัะตะณะธ)
    entity_matches = []
    if item.entities.get('people'):
        for person in item.entities['people']:
            matches = await search(user_id, person, limit=5)
            entity_matches.extend(matches)
    
    # 2. ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ ะฟะพ ัะพะดะตัะถะฐะฝะธั
    semantic_matches = await vector_search(
        user_id, 
        item.title + " " + (item.content or ""),
        limit=5,
        exclude_id=item_id
    )
    
    # 3. ะะพะธัะบ ะฟะพ ัะตะณะฐะผ
    if item.tags:
        tag_matches = await search_by_tags(user_id, item.tags, limit=5)
    
    # 4. ะะฑัะตะดะธะฝัะตะผ ะธ ัะฐะฝะถะธััะตะผ
    all_matches = deduplicate(entity_matches + semantic_matches + tag_matches)
    
    # 5. ะคะธะปััััะตะผ ะฟะพ confidence
    suggestions = [
        SuggestedLink(
            item_id=item_id,
            related_id=match.id,
            confidence=match.score,
            reason=match.match_reason  # "ะพะฑัะธะน ัะตะณ #ะดะธะทะฐะนะฝ" / "ัะฟะพะผะธะฝะฐะฝะธะต ะะฒะฐะฝ"
        )
        for match in all_matches
        if match.score > 0.7 and match.id != item_id
    ]
    
    return suggestions[:3]  # ะะฐะบัะธะผัะผ 3 ะฟัะตะดะปะพะถะตะฝะธั
```

---

## 9. WEBAPP โ ะฑะตะท ะบะพะผะฐะฝะด

### ะะพัััะฟ ัะตัะตะท Menu Button

```python
# ะ main.py ะฟัะธ ััะฐััะต ะฑะพัะฐ
await bot.set_chat_menu_button(
    menu_button=MenuButtonWebApp(
        text="๐ ะัะบัััั",
        web_app=WebAppInfo(url=WEBAPP_URL)
    )
)
```

**ะะตะทัะปััะฐั:** ะะฝะพะฟะบะฐ "๐ ะัะบัััั" ัะปะตะฒะฐ ะพั ะฟะพะปั ะฒะฒะพะดะฐ โ ะพัะบััะฒะฐะตั WebApp

### ะญะบัะฐะฝั (ะฟะปะพัะบะธะน ัะฟะธัะพะบ, ะฑะตะท ะธะตัะฐััะธะธ)

|ะญะบัะฐะฝ|ะะฟะธัะฐะฝะธะต|
|---|---|
|**Inbox**|ะะพะฒะพะต, ะฝะต ัะฐะทะพะฑัะฐะฝะฝะพะต. Swipe ะดะปั ะฑัััััั ะดะตะนััะฒะธะน|
|**ะะฐะดะฐัะธ**|ะะบัะธะฒะฝัะต ะทะฐะดะฐัะธ, ะณััะฟะฟะธัะพะฒะบะฐ: ะัะพััะพัะตะฝะพ โ ะกะตะณะพะดะฝั โ ะะฐะฒััะฐ โ ะะพะทะถะต โ ะะตะท ััะพะบะฐ|
|**ะัั**|ะัะต items ั ัะธะปัััะฐะผะธ ะฟะพ ัะธะฟั|
|**ะะพะธัะบ**|ะกััะพะบะฐ ะฟะพะธัะบะฐ, ัะตะทัะปััะฐัั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ|
|**ะัะพะตะบัั**|ะกะฟะธัะพะบ ะฟัะพะตะบัะพะฒ โ items ะฒะฝัััะธ (ะฟะปะพัะบะธะน ัะฟะธัะพะบ)|

### UX ะฟะฐััะตัะฝั

|ะะตัั|ะะตะนััะฒะธะต|
|---|---|
|**Tap**|ะัะบัััั ะดะตัะฐะปะธ|
|**Swipe right**|ะัะฟะพะปะฝะธัั (ะดะปั ะทะฐะดะฐั)|
|**Swipe left**|ะัะปะพะถะธัั / ะััะธะฒ|
|**Long press**|ะะตะฝั ะดะตะนััะฒะธะน|
|**Pull down**|ะะฑะฝะพะฒะธัั|

### ะัะพะฑัะฐะถะตะฝะธะต ะดะฐั (ะทะฐัะธัะฐ ะพั ะณะฐะปะปััะธะฝะฐัะธะน)

```html
<div class="task-meta">
  <span class="due-display">ะะฐะฒััะฐ (14 ัะฝะฒ) 15:00</span>
  <!-- ะฎะทะตั ะฒะธะดะธั ะธ raw ("ะะฐะฒััะฐ") ะธ normalized ("14 ัะฝะฒ") -->
</div>
```

---

## 10. ะะะะะะขะะะะะกะขะฌ

|ะขัะธะณะณะตั|ะะตะนััะฒะธะต|ะะตะฐะปะธะทะฐัะธั|
|---|---|---|
|ะฃััะพ 8:00|ะะฐะนะดะถะตัั ะฝะฐ ะดะตะฝั|Scheduled job|
|ะะตะดะปะฐะนะฝ -1ั|ะะฐะฟะพะผะธะฝะฐะฝะธะต|remind_at trigger|
|ะะตะดะปะฐะนะฝ -15ะผ|ะะพัะปะตะดะฝะตะต ะฝะฐะฟะพะผะธะฝะฐะฝะธะต|remind_at trigger|
|ะัะพััะพัะตะฝะพ|ะฃะฒะตะดะพะผะปะตะฝะธะต|Periodic check|
|Item ะฒ inbox >3 ะดะฝะตะน|"ะะฐะทะพะฑัะฐัั?"|Weekly job|
|ะกะพััะฐะฝะตะฝะธะต|ะะฒัะพะปะธะฝะบะธะฝะณ suggestions|Post-save hook|
|ะััะฝะธัะฐ 18:00|ะะตะดะตะปัะฝัะน ะพะฑะทะพั|Scheduled job|

---

## 11. ะกะขะะฃะะขะฃะะ ะะะะะะขะ

```
neural-inbox/
โโโ src/
โ   โโโ bot/
โ   โ   โโโ handlers/
โ   โ   โ   โโโ message.py        # ะะกะ ะฒัะพะดั โ Router
โ   โ   โ   โโโ callbacks.py      # Inline ะบะฝะพะฟะบะธ
โ   โ   โโโ jobs/
โ   โ   โ   โโโ reminders.py
โ   โ   โ   โโโ digests.py
โ   โ   โ   โโโ cleanup.py
โ   โ   โโโ keyboards.py
โ   โ
โ   โโโ ai/
โ   โ   โโโ router.py             # Intention Classifier (ะะะฎะงะะะะ)
โ   โ   โโโ agent.py              # AI Agent loop
โ   โ   โโโ tools.py              # Tool definitions
โ   โ   โโโ classifier.py         # ะะปะฐััะธัะธะบะฐัะธั ัะธะฟะฐ ะบะพะฝัะตะฝัะฐ
โ   โ   โโโ extractor.py          # ะะทะฒะปะตัะตะฝะธะต entities + ะดะฐัั
โ   โ   โโโ embeddings.py         # ะะตะบัะพัะธะทะฐัะธั
โ   โ   โโโ linker.py             # ะะฒัะพะปะธะฝะบะธะฝะณ
โ   โ
โ   โโโ db/
โ   โ   โโโ models.py             # SQLAlchemy / raw SQL
โ   โ   โโโ repository.py         # CRUD
โ   โ   โโโ search.py             # Hybrid search (FTS + vector)
โ   โ   โโโ migrations/
โ   โ
โ   โโโ api/
โ   โ   โโโ app.py                # FastAPI
โ   โ   โโโ routes/
โ   โ   โ   โโโ items.py
โ   โ   โ   โโโ search.py
โ   โ   โ   โโโ projects.py
โ   โ   โ   โโโ users.py
โ   โ   โโโ deps.py
โ   โ
โ   โโโ services/
โ   โ   โโโ url_parser.py         # ะะฐััะธะฝะณ ัััะปะพะบ
โ   โ   โโโ pdf_extractor.py
โ   โ   โโโ notifications.py
โ   โ
โ   โโโ webapp/
โ   โ   โโโ index.html
โ   โ   โโโ main.js
โ   โ   โโโ style.css
โ   โ
โ   โโโ config.py
โ   โโโ main.py
โ   โโโ utils/
โ       โโโ time.py
โ       โโโ text.py
โ
โโโ tests/
โ   โโโ test_router.py            # ะขะตััั Intention Classifier
โ   โโโ test_search.py
โ   โโโ test_extractor.py
โ
โโโ requirements.txt
โโโ README.md
```

---

## 12. ะญะขะะะซ ะะะะะะะะขะะ

```
ะะะะะะฏ 1-2: ะคัะฝะดะฐะผะตะฝั
โโโ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
โโโ PostgreSQL + pgvector + tsvector
โโโ ะะฐะทะพะฒัะน ะฑะพั (ะฟัะธัะผ ะฒัะพะดะพะฒ)
โโโ AI Router (Intention Classifier) โ ะะะะขะะงะะ
โโโ ะะฐะทะพะฒะพะต ัะพััะฐะฝะตะฝะธะต items

ะะะะะะฏ 3-4: AI Core
โโโ ะะปะฐััะธัะธะบะฐัะธั ัะธะฟะพะฒ ะบะพะฝัะตะฝัะฐ
โโโ ะะทะฒะปะตัะตะฝะธะต entities (ะดะฐัั ั raw+normalized)
โโโ Embeddings ะฟัะธ ัะพััะฐะฝะตะฝะธะธ
โโโ Hybrid Search (FTS + vector)
โโโ ะะฐะทะพะฒัะต tools ะดะปั ะฐะณะตะฝัะฐ

ะะะะะะฏ 5-6: UX + WebApp
โโโ ะะฑัะฐะฑะพัะบะฐ ะดะฒััะผััะปะตะฝะฝะพััะธ (ััะพัะฝัััะธะต ะฒะพะฟัะพัั)
โโโ WebApp: Inbox + Tasks + Search
โโโ Menu Button ะฒะผะตััะพ ะบะพะผะฐะฝะด
โโโ ะะฐะฟะพะผะธะฝะฐะฝะธั ั ะพัะพะฑัะฐะถะตะฝะธะตะผ raw ะดะฐั

ะะะะะะฏ 7-8: Magic Features + Polish
โโโ ะะฒัะพะปะธะฝะบะธะฝะณ (suggestions)
โโโ ะัะพะฐะบัะธะฒะฝัะต ะดะฐะนะดะถะตััั
โโโ "ะะฐะฑัััะต" ะฝะฐะฟะพะผะธะฝะฐะฝะธั
โโโ ะขะตััะธัะพะฒะฐะฝะธะต
โโโ Beta ั 5-10 ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
```

---

## 13. MVP SCOPE (ัััะบะธะน)

### โ ะ MVP

|ะคะธัะฐ|ะัะธะพัะธัะตั|
|---|---|
|AI Router (ะฑะตะท ะบะพะผะฐะฝะด)|P0|
|ะัะต ัะธะฟั ะฒัะพะดะพะฒ|P0|
|ะะฒัะพะบะปะฐััะธัะธะบะฐัะธั (task/idea/note/resource)|P0|
|ะะทะฒะปะตัะตะฝะธะต ะดะฐั (raw + normalized)|P0|
|Hybrid Search|P0|
|ะะฐะฟะพะผะธะฝะฐะฝะธั|P0|
|WebApp: Inbox + Tasks|P0|
|ะฃัะพัะฝัััะธะต ะฒะพะฟัะพัั ะฟัะธ unclear intent|P1|
|ะะฒัะพ-ัะตะณะธ|P1|
|ะฃััะตะฝะฝะธะน ะดะฐะนะดะถะตัั|P1|

### โฌ ะะพัะปะต MVP

|ะคะธัะฐ|ะัะธะพัะธัะตั|
|---|---|
|ะะฒัะพะปะธะฝะบะธะฝะณ ั ะฟัะตะดะปะพะถะตะฝะธัะผะธ|P2|
|ะัะพะตะบัั|P2|
|ะะตะดะตะปัะฝัะต ะพะฑะทะพัั|P2|
|"ะะฐะฑัััะต" ะฝะฐะฟะพะผะธะฝะฐะฝะธั|P2|
|ะะฐะปะตะฝะดะฐัั ะฒ WebApp|P2|
|ะะพะฝัะฐะบัั ะบะฐะบ ะพัะดะตะปัะฝัะน ัะธะฟ|P3|

---
